== Lacework on OpenShift 4.5 lab

----
oc version
Client Version: 4.5.0-rc.6
Server Version: 4.5.0-rc.6
Kubernetes Version: v1.18.3+6025c28
----

----
oc new-project lacework
----

----
oc create sa samarc
oc adm policy add-scc-to-user privileged -z samarc
oc adm policy add-scc-to-user anyuid -z default -n `oc project -q` --as=system:admin
----

----
Add
serviceAccount: samarc
serviceAccountName: samarc
to the DaemonSet definition in lacework-k8s.yaml

See example at: https://raw.githubusercontent.com/marcredhat/lacework/master/lacework-k8s.yaml
----

NOTE: I also added a nodeSelector so that you can select on which OpenShift nodes your want to deploy Lacework

----
spec:
      nodeSelector:
        name: lacework_worker_nodes
----

----
See example at: https://raw.githubusercontent.com/marcredhat/lacework/master/lacework-k8s.yaml
----


----
wget https://raw.githubusercontent.com/marcredhat/lacework/master/lacework-k8s.yaml
----



----
oc create -f lacework-cfg-k8s.yaml
configmap/lacework-config created
----

----
oc create -f lacework-k8s.yaml
daemonset.apps/lacework-agent created
----

----
NOTE: no lacework-agent pods will be deployed as we have not yet tagged any OpenShift nodes with name=lacework_worker_nodes
We will do that in a further step (see below).
----

----
oc get nodes
NAME                   STATUS     ROLES           AGE   VERSION
master-1.ocp45.local   NotReady   master,worker   9d    v1.18.3+6025c28
master-2.ocp45.local   Ready      master,worker   9d    v1.18.3+6025c28
master-3.ocp45.local   Ready      master,worker   9d    v1.18.3+6025c28
worker-1.ocp45.local   Ready      worker          9d    v1.18.3+6025c28
worker-2.ocp45.local   Ready      worker          9d    v1.18.3+6025c28
----

----
oc label node worker-1.ocp45.local name=lacework_worker_nodes
----

----
[root@dell-r730-001 ~]# oc get all
NAME                       READY   STATUS    RESTARTS   AGE
pod/lacework-agent-5xr7q   1/1     Running   0          52s
pod/lacework-agent-9v5zq   1/1     Running   0          52s
pod/lacework-agent-p2wdf   1/1     Running   0          52s
pod/lacework-agent-z7nwb   1/1     Running   0          52s

NAME                            DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE
daemonset.apps/lacework-agent   4         4         4       4            4           <none>          52s
----


----
oc get ev
LAST SEEN   TYPE     REASON             OBJECT                     MESSAGE
<unknown>   Normal   Scheduled          pod/lacework-agent-5xr7q   Successfully assigned lacework/lacework-agent-5xr7q to master-2.ocp45.local
4m48s       Normal   Pulling            pod/lacework-agent-5xr7q   Pulling image "lacework/datacollector"
4m36s       Normal   Pulled             pod/lacework-agent-5xr7q   Successfully pulled image "lacework/datacollector"
4m35s       Normal   Created            pod/lacework-agent-5xr7q   Created container lacework
4m35s       Normal   Started            pod/lacework-agent-5xr7q   Started container lacework
<unknown>   Normal   Scheduled          pod/lacework-agent-9v5zq   Successfully assigned lacework/lacework-agent-9v5zq to worker-2.ocp45.local
4m50s       Normal   Pulling            pod/lacework-agent-9v5zq   Pulling image "lacework/datacollector"
4m43s       Normal   Pulled             pod/lacework-agent-9v5zq   Successfully pulled image "lacework/datacollector"
4m42s       Normal   Created            pod/lacework-agent-9v5zq   Created container lacework
4m42s       Normal   Started            pod/lacework-agent-9v5zq   Started container lacework
<unknown>   Normal   Scheduled          pod/lacework-agent-p2wdf   Successfully assigned lacework/lacework-agent-p2wdf to master-3.ocp45.local
4m49s       Normal   Pulling            pod/lacework-agent-p2wdf   Pulling image "lacework/datacollector"
4m41s       Normal   Pulled             pod/lacework-agent-p2wdf   Successfully pulled image "lacework/datacollector"
4m41s       Normal   Created            pod/lacework-agent-p2wdf   Created container lacework
4m41s       Normal   Started            pod/lacework-agent-p2wdf   Started container lacework
<unknown>   Normal   Scheduled          pod/lacework-agent-z7nwb   Successfully assigned lacework/lacework-agent-z7nwb to worker-1.ocp45.local
4m49s       Normal   Pulling            pod/lacework-agent-z7nwb   Pulling image "lacework/datacollector"
4m42s       Normal   Pulled             pod/lacework-agent-z7nwb   Successfully pulled image "lacework/datacollector"
4m42s       Normal   Created            pod/lacework-agent-z7nwb   Created container lacework
4m42s       Normal   Started            pod/lacework-agent-z7nwb   Started container lacework
4m50s       Normal   SuccessfulCreate   daemonset/lacework-agent   Created pod: lacework-agent-p2wdf
4m50s       Normal   SuccessfulCreate   daemonset/lacework-agent   Created pod: lacework-agent-9v5zq
4m50s       Normal   SuccessfulCreate   daemonset/lacework-agent   Created pod: lacework-agent-z7nwb
4m50s       Normal   SuccessfulCreate   daemonset/lacework-agent   Created pod: lacework-agent-5xr7q
----
